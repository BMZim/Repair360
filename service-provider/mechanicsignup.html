<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mechanic Sign Up</title>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: url('img/LS.jpeg') no-repeat center center fixed;
      background-size: cover;
    }

    .form-container {
      background-color: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(15px);
      border-radius: 20px;
      padding: 30px;
      max-width: 900px;
      margin: 30px auto;
      color: white;
      display: flex;
      flex-wrap: wrap;
      gap: 30px;
    }

    .form-container h2 {
      width: 100%;
      text-align: center;
      font-size: 36px;
      margin-bottom: 20px;
    }

    .form-group {
      flex: 1 1 40%;
      display: flex;
      flex-direction: column;
    }

    .form-group textarea {
      height: 100px;
      resize: none;
    }

    label {
      margin-bottom: 8px;
      font-weight: 600;
    }

    input, select, textarea {
      padding: 10px;
      font-size: 16px;
      border-radius: 10px;
      border: none;
    }

    .gender-group {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .full-width {
      flex: 1 1 100%;
    }
    .email-container {
      display: flex;
      gap: 8px;
    }
    .email-container input {
      flex: 1;
    }
    .email-container button {
      background-color: #007bff;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 0 12px;
      cursor: pointer;
    }
    .email-container button:hover {
      opacity: 0.9;
    }

    .button-group {
      display: flex;
      justify-content: space-between;
      gap: 20px;
      width: 100%;
      margin-top: 20px;
    }

    button {
      padding: 10px 30px;
      font-size: 16px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
    }
    

    #submit {
      background-color: #28a745;
      color: white;
    }
    #submit:hover{
      background-color: #5fdf7d;
    }

    #reset {
      background-color: #ddd;
      color: black;
    }
    #reset:hover{
      background-color: #a0aaa2;
    }

    .password-wrapper {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .eye-icon {
      cursor: pointer;
    }
  </style>
</head>

<body>
  <form class="form-container" method="POST" >
    <h2>Mechanic Sign Up</h2>

    <div class="form-group">
      <label>Full Name:</label>
      <input type="text" name="name" id="name" placeholder="Enter Your Full Name" required />
    </div>

    <div class="form-group">
      <label>Mechanic ID:</label>
      <input type="text" name="mechanicid" id="mechanicid" placeholder="Enter Your ID" readonly />
    </div>

    <div class="form-group">
        <label for="email">Email</label>
        <div class="email-container">
          <input type="email" id="email" name="email" placeholder="example@domain.com" required>
          <button type="button" id="sendOtpBtn">Send OTP</button>
        </div>
      </div>

      <!-- OTP Input (hidden initially) -->
      <div class="form-group" id="otpGroup" style="display: none;">
        <label for="otpInput">Enter OTP</label>
        <input type="number" id="otpInput" placeholder="Enter OTP" required>
        <small id="otpMessage" style="color:red;"></small>
      </div>

    <div class="form-group">
      <label>Password:</label>
      <div class="password-wrapper">
        <input type="password" name="password" id="password" placeholder="Enter Password" required />
        <span class="eye-icon">üëÅÔ∏è</span>
      </div>
    </div>

    <div class="form-group">
      <label>Date of Birth:</label>
      <input type="date" name="dob" id="dob" required />
    </div>

    <div class="form-group">
      <label>Phone No:</label>
      <input type="tel" name="phone" placeholder="Enter Phone No" required />
    </div>

    <div class="form-group">
        <label for="nid">NID</label>
        <input type="number" id="nid" name="nid" placeholder="Enter your NID no." required>
      </div>

    <div class="form-group">
      <label>Gender:</label>
      <div class="gender-group">
        <label><input type="radio" name="gender" value="Male" checked /> Male</label>
        <label><input type="radio" name="gender" value="Female" /> Female</label>
        <label><input type="radio" name="gender" value="Another" /> Another</label>
      </div>
    </div>

    <div class="form-group">
      <label>Division:</label>
      <select name="division" required>
        <option value="">(Please select your Division)</option>
        <option value="Chattagram">Chattagram</option>
        <option value="Rajshahi">Rajshahi</option>
        <option value="Khulna">Khulna</option>
        <option value="Barishal">Barishal</option>
        <option value="Dhaka">Dhaka</option>
        <option value="Sylhet">Sylhet</option>
        <option value="Rangpur">Rangpur</option>
        <option value="Mymensingh">Mymensingh</option>
      </select>
    </div>

    <div class="form-group">
        <label for="city">City</label>
        <input type="text" id="city" name="city" placeholder="Enter your city" required>
      </div>

     <div class="form-group">
    <label>Type of Mechanic:</label>
    <select name="mechanicType" id="mechanicType" required>
      <option value="">(Select Mechanic Type)</option>
      <option value="Home">Home</option>
      <option value="Vehicle">Vehicle</option>
      <option value="Tech">Tech</option>
    </select>
  </div>

    <div class="form-group">
      <label>Years of Experience:</label>
      <input type="number" name="experience" id="experience" min="0" placeholder="e.g., 5" required />
    </div>

    <div class="form-group full-width">
      <label>Address:</label>
      <textarea name="address" id="address" placeholder="Enter Your Present Address (including district, Upazila, home no, road no, flat no.)" required></textarea>
    </div>

    <div class="button-group">
      <button type="reset" id="reset">Reset</button>
      <button type="submit" value="submit" id="submit" name="submit">Submit</button>
    </div>
  </form>

<script src="https://smtpjs.com/v3/smtp.js"></script>
  <script>
$(document).ready(function () {

    // ---------- 1. Generate Mechanic ID ----------
    let counter = Math.floor(Math.random() * 9999) + 1;
    $('#mechanicid').val('25' + String(counter).padStart(4, '0'));

    // ---------- 2. Toggle Password ----------
    $('.eye-icon').click(function () {
        const pwd = $('#password');
        pwd.attr('type', pwd.attr('type') === 'password' ? 'text' : 'password');
    });

    // ---------- 3. OTP Sending ----------
    let generatedOTP = null;

    $('#sendOtpBtn').click(function () {
        const email = $('#email').val().trim();
        if (!email) {
            Swal.fire({ icon: "error", title: "Error", text: "Please enter your email first!" });
            return;
        }

        generatedOTP = Math.floor(100000 + Math.random() * 900000); // 6-digit OTP
        $('#otpGroup').show();

        // Send email using SMTPJS
        Email.send({
            SecureToken: "1586ed89-b601-4653-bfcf-7c021b711518",
            To: email,
            From: "shafinrubaer@gmail.com",
            Subject: "Email Verification",
            Body: "Your OTP is: " + generatedOTP
        }).then(message => {
            if (message === "OK") {
                Swal.fire({ title: "OTP Sent!", text: "Check your email inbox.", icon: "success", timer: 1500 });
            } else {
                Swal.fire({ icon: "error", title: "Error", text: "Failed to send OTP. Try again." });
            }
        });
    });

    
    // ---------- 4. Form Submission ----------
    $('#submit').click(function (e) {
        e.preventDefault();

        
        const enteredOTP = $('#otpInput').val().trim();
        if (!enteredOTP) {
          Swal.fire({
                            icon: "error",
                            title: "Oops...",
                            text: "Please verify your email before proceeding!!",
                            footer: 'Not Verified Email'
                            });
            $('#otpMessage').text('Please verify your email before proceeding!!');
            return;
        }

        if (!generatedOTP || parseInt(enteredOTP) !== generatedOTP) {
            Swal.fire({
                            icon: "error",
                            title: "Oops...",
                            text: "Invalid OTP. Please try again.",
                            footer: 'Wrong OTP'
                            });
            $('#otpMessage').text('Invalid OTP. Please try again.');
            return;
        }

        // Check form validity
        

        // Age validation
        const dob = new Date($('#dob').val());
        const today = new Date();
        let age = today.getFullYear() - dob.getFullYear();
        const monthDiff = today.getMonth() - dob.getMonth();
        if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < dob.getDate())) age--;
        if (age < 18) {
            Swal.fire({ icon: "error", title: "Oops...", text: "You must be at least 18 years old to register." });
            return;
        }

        // Collect form data
                var name = $('#name').val();
                var mecid = $('#mechanicid').val();
                var email = $('#email').val();
                var phone= $('input[name="phone"]').val().trim();
                var password = $('#password').val();
                var address = $('#address').val();
                var date = $('#dob').val();
                var experience = $('#experience').val();
                var city = $('#city').val();
                var division= $('select[name="division"]').val();
                var type = $('#mechanicType').val();
                var gender= $('input[name="gender"]:checked').val()
                var nid = $('#nid').val();
                if (!this.form.checkValidity()) {
            Swal.fire({ icon: "error", title: "Error", text: "Please fill all required fields." });
            return;
        }

				$.ajax({
					type: 'POST',
					url: 'mechanicsignup.php',
					data: {
                            name: name,
                            mecid: mecid,
                            email: email,
                            phone: phone,
                            password: password,
                            address: address,
                            date: date,
                            experience: experience,
                            city: city,
                            division: division,
                            type: type,
                            gender: gender,
                            nid: nid,
                },
					success: function(data){

                        if(data.trim() ==  "0"){
                            Swal.fire({
                                title: "Good job!",
                                text: "SignUp Successfull",
                                icon: "success"
                                }).then(()=>{
                                    var mectype = $('#mechanicType').val();
                                    var id = $('#mechanicid').val();

                                    if (type && id) {
                                        window.location.href = `skills.php?type=${encodeURIComponent(type)}&id=${encodeURIComponent(id)}`;
                                    } else {
                                        Swal.fire({ icon: "error", title: "Error", text: "Mechanic type or ID missing!" });
                                    }
                                });
                        }else if(data.trim() ==  "1"){  
                            Swal.fire({
                            icon: "error",
                            title: "Oops...",
                            text: "Something went wrong!",
                            footer: 'Email already exists!!'
                            });
                        }else if(data.trim() ==  "2"){
                            Swal.fire({
                            icon: "error",
                            title: "Oops...",
                            text: "Something went wrong!",
                            footer: 'NID already exists!!'
                            });
                        }else{
                            alert(data);
                            Swal.fire({
                            icon: "error",
                            title: "Oops...",
                            text: "Something went wrong!",
                            footer: 'Contact with support center'
                            });
                        }
                        
							
					}
				});
    });
});
</script>

</body>
</html>
